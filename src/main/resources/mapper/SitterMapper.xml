<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.bomobomo.mapper.SitterMapper">

    <select id="sitterTotal" resultType="_int">
        SELECT COUNT(*) FROM EMP
    </select>

    <select id="sitterList" resultType="empVo">
        SELECT  RNUM, EMP_NUMBER, EMP_NAME, EMP_AGE, EMP_GENDER, EMP_PHONE, EMP_EMAIL, EMP_DATE, EMP_CONTENT, avg
        FROM (
            SELECT ROWNUM AS RNUM, e.EMP_NUMBER, e.EMP_NAME, e.EMP_AGE, e.EMP_GENDER, e.EMP_PHONE, e.EMP_EMAIL, e.EMP_DATE, e.EMP_CONTENT, s1.avg
            FROM EMP e left join(
                select EMP_NUMBER, avg(RATING) avg from SITTER_BOARD sb
                group by EMP_NUMBER
                )s1 on e.EMP_NUMBER = s1.EMP_NUMBER
                <![CDATA[
                WHERE ROWNUM <= #{page} * #{amount}
                ]]>
            ORDER BY EMP_NUMBER DESC
        )
        WHERE RNUM > (#{page} - 1) * #{amount}
    </select>

    <select id="selectTotal" resultType="_int">
        SELECT COUNT(EMP_NUMBER)
        FROM EMP
    </select>

    <select id="sitterInfo" resultType="empDto">
        SELECT *
        FROM EMP
        WHERE EMP_NUMBER = ${empNumber}
    </select>

    <select id="sitterBoardList" resultType="sitterBoardDto">
        SELECT *
        FROM SITTER_BOARD
                    <![CDATA[
        WHERE EMP_NUMBER = ${empNumber} AND ROWNUM <= 10
        ]]>
    </select>

    <select id="addrCheck" resultType="empVo">
        SELECT  RNUM, EMP_NUMBER, EMP_NAME, EMP_AGE, EMP_GENDER, EMP_PHONE, EMP_EMAIL, EMP_DATE, EMP_CONTENT, avg
        FROM (
            SELECT ROWNUM AS RNUM, e.EMP_NUMBER, e.EMP_NAME, e.EMP_AGE, e.EMP_GENDER, e.EMP_PHONE, e.EMP_EMAIL, e.EMP_DATE, e.EMP_CONTENT, s1.avg
            FROM EMP e left join(
                select EMP_NUMBER, avg(RATING) avg from SITTER_BOARD sb
                group by EMP_NUMBER
                )s1 on e.EMP_NUMBER = s1.EMP_NUMBER
                <![CDATA[
                WHERE ROWNUM <= #{page} * #{amount} AND EMP_GENDER = 'F'
                ]]>
            ORDER BY EMP_NUMBER DESC
        )
        WHERE RNUM > (#{page} - 1) * #{amount}
    </select>

    <select id="sitterAddrTotal" resultType="_int">
        SELECT COUNT(*) FROM EMP WHERE EMP_GENDER = 'F'
    </select>

    <select id="sitterReview" resultType="double">
        SELECT s.RATING, e.EMP_NUMBER
        FROM EMP e JOIN SITTER_BOARD s
        ON e.EMP_NUMBER = s.EMP_NUMBER
        WHERE e.EMP_NUMBER = #{empNumber}
    </select>

    <select id="sitterAvg" resultType="sitterBoardVo">

    </select>
    <!--    <select id="addrCheck" resultType="int">-->
<!--        select *-->
<!--        from EMP-->
<!--        WHERE EMP_시터시도 = 시터가 업무 가능한 시도 AND EMP_시터구군 = 시터가 업무 가능한 구군-->
<!--    </select>-->

</mapper>