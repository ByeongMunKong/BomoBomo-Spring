<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.bomobomo.mapper.AdminMapper">
    <select id="login" resultType="adminDto">
        SELECT *
        FROM ADMIN
        WHERE ADMIN_ID = #{adminId} AND ADMIN_PASSWORD = #{adminPassword}
    </select>

    <select id="weeklyRegister" resultType="weeklyRegisterVo">
        WITH DateRange AS (
        SELECT TRUNC(SYSDATE) - LEVEL + 1 AS registration_date
        FROM DUAL
        <![CDATA[
        CONNECT BY LEVEL <= 7
        ]]>
        )
        SELECT
        TO_CHAR(DateRange.registration_date, 'MM-DD') AS month_day,
        NVL(user_counts.daily_user_count, 0) AS daily_user_count
        FROM DateRange
        LEFT JOIN (
        SELECT
        TO_CHAR(TRUNC(register_date), 'MM-DD') AS registration_date,
        COUNT(*) AS daily_user_count
        FROM users
        WHERE register_date >= TRUNC(SYSDATE) - 7
        GROUP BY TO_CHAR(TRUNC(register_date), 'MM-DD')
        ) user_counts
        ON TO_CHAR(DateRange.registration_date, 'MM-DD') = user_counts.registration_date
        ORDER BY DateRange.registration_date;
    </select>
</mapper>